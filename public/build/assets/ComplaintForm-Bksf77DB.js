import{r as g,j as e,k as p,S as C}from"./app-CpEXxolg.js";import{u as D,t as F,F as L,a as l,b as d,c as o,d as c,e as m,g as P,f as V,h as S}from"./zod-DF_wlRVz.js";import{c as k}from"./utils-CytzSlOG.js";import{u as T}from"./use-media-query-CsKVkmYz.js";import{B as u}from"./button-B7IoA94o.js";import{D as M,a as A,b as E,c as R,d as H,e as I,g as K,f as O}from"./dialog-DoxKVBhp.js";import{D as B,a as G,b as U,c as $,d as z,e as Q,f as _,g as q}from"./drawer-DfOk9bKX.js";import{I as h}from"./input-C7N6sVf4.js";import J from"./VoiceRecorder-C7GyoZ6s.js";import W from"./MyMap-u9jSd0YI.js";import"./index-CtIrZieG.js";import"./index-C71Lb3zQ.js";import"./index-D5FzsrKy.js";import"./index-BZkdM-th.js";import"./index-sA5E4vLM.js";import"./proxy-CV8dqZDQ.js";import"./label-CHWWiTCa.js";import"./index-CAvpFn2P.js";import"./index-DRiFVXpp.js";import"./leaflet-QtgQBmu0.js";import"./Popup-DbDlvFUy.js";const v=g.forwardRef(({className:x,...s},t)=>e.jsx("textarea",{className:k("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:border-slate-900 focus-visible:border-2 focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",x),ref:t,...s}));v.displayName="Textarea";function fe(){const[x,s]=g.useState(!1),[t,a]=g.useState(!1);return T("(min-width: 768px)")?e.jsxs(M,{open:x,onOpenChange:s,children:[e.jsx(A,{asChild:!0,children:e.jsx(u,{variant:"outline",className:"rounded-xl h-full font-medium text-base",children:"Laporkan"})}),e.jsxs(E,{className:"sm:max-w-4xl h-[90vh]","data-lenis-prevent":!0,onInteractOutside:j=>{j.preventDefault()},children:[e.jsxs(R,{children:[e.jsx(H,{children:"Laporkan"}),e.jsx(I,{children:"Setiap laporan yang Anda kirim membantu dalam upaya perlindungan sumber daya alam dan mitigasi risiko."})]}),e.jsx("div",{className:"overflow-y-auto pr-3 pb-3 scrollbar-thin",children:e.jsx(b,{setDisable:a,setOpen:s})}),e.jsxs(K,{children:[e.jsx(O,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",children:"Close"})}),e.jsx(u,{type:"submit",form:"complaint-form",disabled:t,children:"Kirim Pengaduan"})]})]})]}):e.jsxs(B,{open:x,onOpenChange:s,children:[e.jsx(G,{asChild:!0,children:e.jsx(u,{variant:"outline",className:"rounded-xl h-full font-medium text-base",children:"Laporkan"})}),e.jsxs(U,{className:"h-[85vh]",children:[e.jsxs($,{className:"text-left",children:[e.jsx(z,{children:"Laporkan"}),e.jsx(Q,{children:"Setiap laporan yang Anda kirim membantu dalam upaya perlindungan sumber daya alam dan mitigasi risiko."})]}),e.jsx("div",{className:"overflow-y-auto px-4 scrollbar-thin pb-4","data-lenis-prevent":!0,children:e.jsx(b,{className:"px-4",setDisable:a,setOpen:s})}),e.jsxs(_,{className:"pt-2",children:[e.jsx(q,{asChild:!0,children:e.jsx(u,{variant:"outline",children:"Cancel"})}),e.jsx(u,{type:"submit",disabled:t,form:"complaint-form",children:"Kirim Pengaduan"})]})]})]})}function b({className:x,setDisable:s,setOpen:t}){const a=D({resolver:F(S),defaultValues:{name:"",telp:"",message:"",audio:void 0,latitude:"",longitude:"",files:[]},mode:"onChange"}),f=r=>{r.preventDefault(),s(!0),C.post(route("complaint.store"),a.getValues(),{onSuccess:()=>{p.success("Pengaduan berhasil dikirim!"),a.reset(),a.setValue("audio",void 0),a.setValue("telp",""),s(!1),t&&t(!1)},onError:n=>{s(!1),p.error("Terjadi Kesalahan"),Object.keys(n).forEach(i=>{a.setError(i,{type:"server",message:n[i]})})}})},j=r=>{a.setValue("latitude",r.lat),a.setValue("longitude",r.lng),a.trigger("latitude"),a.trigger("longitude")},N=r=>{a.setValue("files",r)},[y,w]=g.useState(null);return e.jsx(L,{...a,children:e.jsxs("form",{onSubmit:f,encType:"multipart/form-data",className:"space-y-4",id:"complaint-form",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-x-5",children:[e.jsx(l,{control:a.control,name:"name",render:({field:r})=>e.jsxs(d,{children:[e.jsx(o,{children:"Nama"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Ketikkan Nama Anda",...r,className:"focus-visible:ring-[#063b3e]"})}),e.jsx(m,{})]})}),e.jsx(l,{control:a.control,name:"telp",render:({field:r,fieldState:n})=>e.jsxs(d,{children:[e.jsx(o,{children:"Nomor HP"}),e.jsx(c,{children:e.jsx(h,{type:"tel",placeholder:"Masukkan nomor HP Anda",...r,className:k("focus-visible:ring-[#063b3e] block h-11 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background md:text-sm",n.error&&"border-red-500")})}),e.jsx(m,{})]})})]}),e.jsx(l,{control:a.control,name:"message",render:({field:r})=>e.jsxs(d,{children:[e.jsx(o,{children:"Pesan"}),e.jsx(c,{children:e.jsx(v,{rows:5,placeholder:"Tuliskan pesan Anda",className:"resize-none focus-visible:ring-[#063b3e]",...r})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(P,{className:`order-2 ${r.value.length>450?"text-red-500":""}`,children:["Maks. ",r.value.length||0,"/450"]}),e.jsx(m,{})]})]})}),e.jsx(l,{control:a.control,name:"audio",render:({field:r})=>e.jsxs(d,{children:[e.jsx(o,{optional:!0,children:"Rekam Suara"}),e.jsx(c,{children:e.jsx(J,{onAudioReady:n=>{const i=new File([n],"voice_recording.wav",{type:"audio/wav"});a.setValue("audio",i),r.onChange(i)}})}),e.jsx(m,{})]})}),e.jsx(l,{control:a.control,name:"files",render:({field:r})=>e.jsxs(d,{children:[e.jsx(o,{children:"Dokumen Pendukung"}),e.jsx(c,{children:e.jsx("div",{className:"w-full mx-auto min-h-80 border border-dashed bg-white dark:bg-black border-neutral-200 dark:border-neutral-800 rounded-lg",children:e.jsx(V,{onChange:N})})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"space-y-2 w-full",children:[e.jsxs("div",{className:"md:flex items-center gap-x-1",children:[e.jsx(o,{children:"Pilih Lokasi di Peta "}),e.jsx("span",{className:"text-sm font-medium",children:"atau "}),e.jsx("button",{type:"button",className:"text-sm font-medium text-blue-500 underline",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(r=>{const{latitude:n,longitude:i}=r.coords;a.setValue("latitude",n),a.setValue("longitude",i),a.trigger("latitude"),a.trigger("longitude"),w({lat:n,lng:i}),p.success("Lokasi berhasil diambil!")},r=>{p.error("Tidak dapat mengambil lokasi: "+r.message)}):p.error("Geolocation tidak didukung di browser ini.")},children:"Gunakan Lokasi saat ini"})]}),e.jsx(W,{className:"h-[20rem] w-full",onCoordinatesChange:j,currentLocation:y})]}),e.jsx(l,{control:a.control,name:"latitude",render:({field:r})=>e.jsxs(d,{children:[e.jsx(o,{children:"Latitude"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Masukkan Latitude",...r,className:"focus-visible:ring-[#063b3e]"})}),e.jsx(m,{})]})}),e.jsx(l,{control:a.control,name:"longitude",render:({field:r})=>e.jsxs(d,{children:[e.jsx(o,{children:"Longitude"}),e.jsx(c,{children:e.jsx(h,{placeholder:"Masukkan Longitude",...r,type:"text",className:"focus-visible:ring-[#063b3e]"})}),e.jsx(m,{})]})})]})})}export{fe as ComplaintForm};
